<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Daftar Anime - Kuramanime V3</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --bg-main: #141414;
            --bg-panel: #1a1a1a;
            --bg-card: #1f1f1f;
            --border-soft: rgba(255, 255, 255, 0.08);
            --border-strong: rgba(255, 255, 255, 0.15);
            --text-primary: #ffffff;
            --text-muted: #9ea0a8;
            --accent: #e50914;
            --accent-soft: rgba(229, 9, 20, 0.16);
            --accent-strong: rgba(229, 9, 20, 0.45);
            --shadow-soft: 0 12px 32px rgba(0, 0, 0, 0.45);
            --shadow-accent: 0 12px 32px rgba(229, 9, 20, 0.35);
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background:
                radial-gradient(circle at 12% 20%, rgba(229, 9, 20, 0.18) 0%, transparent 45%),
                radial-gradient(circle at 88% 12%, rgba(229, 9, 20, 0.12) 0%, transparent 50%),
                var(--bg-main);
            color: var(--text-primary);
            min-height: 100vh;
            padding: 20px;
        }

        .navbar {
            background: rgba(18, 18, 18, 0.85);
            backdrop-filter: blur(14px);
            border-radius: 16px;
            padding: 15px 30px;
            margin-bottom: 30px;
            box-shadow: var(--shadow-soft);
            border: 1px solid var(--border-soft);
        }

        .navbar-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 20px;
        }

        .nav-links {
            display: flex;
            align-items: center;
            gap: 20px;
        }

        .nav-links a {
            text-decoration: none;
            color: var(--text-muted);
            font-weight: 500;
            border-bottom: 2px solid transparent;
            padding-bottom: 4px;
            transition: color 0.3s ease, border-color 0.3s ease;
        }

        .nav-links a:hover {
            color: var(--text-primary);
        }

        .nav-links a.active {
            color: var(--accent);
            border-color: var(--accent);
            font-weight: 600;
        }

        .logo {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--accent);
            cursor: pointer;
            text-shadow: 0 0 18px rgba(229, 9, 20, 0.35);
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        .header {
            text-align: center;
            margin-bottom: 40px;
            background: var(--bg-panel);
            backdrop-filter: blur(12px);
            padding: 30px;
            border-radius: 20px;
            box-shadow: var(--shadow-soft);
            border: 1px solid var(--border-soft);
        }

        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            color: var(--text-primary);
            text-shadow: 0 0 18px rgba(0, 0, 0, 0.45);
        }

        .header p {
            color: var(--text-muted);
            font-size: 1.05rem;
        }

        #headerStats {
            color: var(--accent);
            font-size: 0.95rem;
            margin-top: 10px;
        }

        .sort-menu {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 30px;
        }

        .sort-button {
            background: var(--bg-card);
            border: 1px solid var(--border-soft);
            border-radius: 12px;
            padding: 20px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            text-decoration: none;
            color: inherit;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 10px;
            box-shadow: var(--shadow-soft);
        }

        .sort-button:hover {
            transform: translateY(-6px);
            box-shadow: var(--shadow-accent);
            border-color: var(--accent-strong);
            background: var(--accent-soft);
        }

        .sort-button.active {
            border-color: var(--accent);
            background: var(--accent-soft);
            box-shadow: var(--shadow-accent);
        }

        .sort-icon {
            font-size: 2.5rem;
            color: var(--accent);
        }

        .sort-name {
            font-size: 1.2rem;
            font-weight: 600;
            color: var(--text-primary);
        }

        .sort-desc {
            font-size: 0.85rem;
            color: var(--text-muted);
        }

        .loading {
            text-align: center;
            padding: 60px;
            font-size: 1.3rem;
            color: var(--accent);
        }

        .anime-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
            gap: 20px;
            margin-bottom: 40px;
        }

        .anime-card {
            background: var(--bg-card);
            border-radius: 15px;
            overflow: hidden;
            transition: all 0.3s ease;
            cursor: pointer;
            border: 1px solid var(--border-soft);
            box-shadow: var(--shadow-soft);
            position: relative;
        }

        .anime-card:hover {
            transform: translateY(-10px);
            box-shadow: var(--shadow-accent);
            border-color: var(--accent-strong);
        }

        .anime-poster {
            width: 100%;
            height: 260px;
            object-fit: cover;
            display: block;
        }

        .anime-info {
            padding: 15px;
        }

        .anime-title {
            font-size: 0.95rem;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 8px;
            overflow: hidden;
            text-overflow: ellipsis;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            line-height: 1.4;
            min-height: 2.8em;
        }

        .anime-episode {
            font-size: 0.85rem;
            color: var(--accent);
            margin-bottom: 8px;
        }

        .anime-tags {
            display: flex;
            flex-wrap: wrap;
            gap: 5px;
            margin-top: 8px;
        }

        .anime-tag {
            font-size: 0.7rem;
            padding: 3px 8px;
            background: var(--accent-soft);
            border: 1px solid var(--accent-strong);
            border-radius: 6px;
            color: var(--accent);
        }

        .trending-badge {
            position: absolute;
            top: 10px;
            right: 10px;
            background: var(--accent);
            color: var(--text-primary);
            padding: 5px 10px;
            border-radius: 20px;
            font-size: 0.75rem;
            font-weight: 600;
            box-shadow: var(--shadow-accent);
        }

        .pagination {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 10px;
            margin: 40px 0;
        }

        .pagination button {
            padding: 12px 24px;
            background: var(--accent-soft);
            border: 1px solid var(--accent-strong);
            border-radius: 10px;
            color: var(--text-primary);
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 600;
        }

        .pagination button:hover:not(:disabled) {
            background: var(--accent);
            transform: translateY(-2px);
        }

        .pagination button:disabled {
            opacity: 0.3;
            cursor: not-allowed;
        }

        .pagination span {
            padding: 12px 20px;
            background: var(--bg-card);
            border-radius: 10px;
            font-weight: 600;
        }

        @media (max-width: 768px) {
            .sort-menu {
                grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
                gap: 10px;
            }

            .sort-button {
                padding: 15px;
            }

            .sort-icon {
                font-size: 2rem;
            }

            .sort-name {
                font-size: 1rem;
            }

            .anime-grid {
                grid-template-columns: repeat(auto-fill, minmax(140px, 1fr));
                gap: 12px;
            }

            .header h1 {
                font-size: 1.8rem;
            }
        }
    </style>
</head>
<body>
    <nav class="navbar">
        <div class="navbar-content">
            <div class="logo" onclick="window.location.href='/v3/home'">üéå AnimMe V3</div>
            <div class="nav-links">
                <a href="/v3/home">Beranda</a>
                <a href="/v3/animelist" class="active">Daftar Anime</a>
                <a href="/v3/search">Cari</a>
            </div>
        </div>
    </nav>

    <div class="container">
        <div class="header">
            <h1>üì∫ Daftar Anime</h1>
            <p>Jelajahi semua anime dengan berbagai pilihan urutan sorting</p>
            <p id="headerStats"></p>
        </div>

        <div class="sort-menu">
            <div class="sort-button" onclick="loadAnimeList(1, null)" data-order="default">
                <div class="sort-icon">üìã</div>
                <div class="sort-name">Default</div>
                <div class="sort-desc">Urutan default</div>
            </div>
            <div class="sort-button" onclick="loadAnimeList(1, 'oldest')" data-order="oldest">
                <div class="sort-icon">‚è™</div>
                <div class="sort-name">Terlama</div>
                <div class="sort-desc">Anime paling lama</div>
            </div>
            <div class="sort-button" onclick="loadAnimeList(1, 'latest')" data-order="latest">
                <div class="sort-icon">‚è©</div>
                <div class="sort-name">Terbaru</div>
                <div class="sort-desc">Anime terbaru</div>
            </div>
            <div class="sort-button" onclick="loadAnimeList(1, 'popular')" data-order="popular">
                <div class="sort-icon">‚≠ê</div>
                <div class="sort-name">Teratas</div>
                <div class="sort-desc">Paling populer</div>
            </div>
            <div class="sort-button" onclick="loadAnimeList(1, 'most_viewed')" data-order="most_viewed">
                <div class="sort-icon">üëÅÔ∏è</div>
                <div class="sort-name">Terpopuler</div>
                <div class="sort-desc">Paling banyak dilihat</div>
            </div>
            <div class="sort-button" onclick="loadAnimeList(1, 'updated')" data-order="updated">
                <div class="sort-icon">üîÑ</div>
                <div class="sort-name">Terupdate</div>
                <div class="sort-desc">Baru diperbarui</div>
            </div>
            <div class="sort-button" onclick="loadAnimeList(1, 'ascending')" data-order="ascending">
                <div class="sort-icon">üî§</div>
                <div class="sort-name">A-Z</div>
                <div class="sort-desc">Urutan alfabetis A-Z</div>
            </div>
            <div class="sort-button" onclick="loadAnimeList(1, 'descending')" data-order="descending">
                <div class="sort-icon">üî°</div>
                <div class="sort-name">Z-A</div>
                <div class="sort-desc">Urutan alfabetis Z-A</div>
            </div>
        </div>

        <div id="loadingIndicator" class="loading" style="display: block;">
            ‚è≥ Memuat daftar anime...
        </div>

        <div id="animeGrid" class="anime-grid" style="display: none;"></div>

        <div id="pagination" class="pagination" style="display: none;"></div>
    </div>

    <script>
        let currentPage = 1;
        let currentOrderBy = null;

        function updateActiveButton(orderBy) {
            document.querySelectorAll('.sort-button').forEach(btn => {
                btn.classList.remove('active');
            });
            const activeBtn = document.querySelector(`.sort-button[data-order="${orderBy || 'default'}"]`);
            if (activeBtn) {
                activeBtn.classList.add('active');
            }
        }

        async function loadAnimeList(page = 1, orderBy = null) {
            currentPage = page;
            currentOrderBy = orderBy;
            
            updateActiveButton(orderBy);
            
            try {
                document.getElementById('loadingIndicator').style.display = 'block';
                document.getElementById('animeGrid').style.display = 'none';
                document.getElementById('pagination').style.display = 'none';

                let url = `/api/v3/kuramanime/anime-list?page=${page}`;
                if (orderBy) {
                    url += `&order_by=${orderBy}`;
                }

                const response = await fetch(url);
                const data = await response.json();

                if (data.status === 'success') {
                    displayAnimeList(data.data);
                } else {
                    throw new Error(data.message || 'Failed to load anime list');
                }

                document.getElementById('loadingIndicator').style.display = 'none';
            } catch (error) {
                console.error('Error loading anime list:', error);
                document.getElementById('loadingIndicator').innerHTML = 
                    '‚ùå Gagal memuat daftar anime. Silakan refresh halaman.';
            }
        }

        function displayAnimeList(data) {
            const grid = document.getElementById('animeGrid');
            const animeList = data.anime_list || [];

            if (animeList.length === 0) {
                grid.innerHTML = '<p style="text-align:center; color:#a0a0b0; grid-column: 1/-1;">Tidak ada anime tersedia</p>';
                grid.style.display = 'grid';
                return;
            }

            grid.innerHTML = animeList.map(anime => `
                <div class="anime-card" onclick="window.location.href='/v3/detail?animeId=${anime.anime_id}&slug=${anime.slug}'">
                    ${anime.is_trending ? '<div class="trending-badge">üî• Trending</div>' : ''}
                    <img src="${anime.poster}" alt="${anime.title}" class="anime-poster" onerror="this.src='https://via.placeholder.com/180x260?text=No+Image'">
                    <div class="anime-info">
                        <div class="anime-title">${anime.title}</div>
                        ${anime.episode_text ? `<div class="anime-episode">${anime.episode_text}</div>` : ''}
                        ${anime.tags && anime.tags.length > 0 ? `
                            <div class="anime-tags">
                                ${anime.tags.slice(0, 2).map(tag => `<span class="anime-tag">${tag.label}</span>`).join('')}
                            </div>
                        ` : ''}
                    </div>
                </div>
            `).join('');

            grid.style.display = 'grid';
            
            document.getElementById('headerStats').textContent = 
                `üìä Menampilkan ${animeList.length} anime | Halaman ${data.pagination.current_page}${data.pagination.total_pages ? ' dari ' + data.pagination.total_pages : ''}`;

            // Display pagination
            displayPagination(data.pagination);
        }

        function displayPagination(pagination) {
            const paginationDiv = document.getElementById('pagination');
            
            paginationDiv.innerHTML = `
                <button onclick="loadAnimeList(${pagination.current_page - 1}, '${currentOrderBy || ''}')" 
                        ${!pagination.has_prev ? 'disabled' : ''}>
                    ‚Äπ Sebelumnya
                </button>
                <span>Halaman ${pagination.current_page}${pagination.total_pages ? ' / ' + pagination.total_pages : ''}</span>
                <button onclick="loadAnimeList(${pagination.current_page + 1}, '${currentOrderBy || ''}')" 
                        ${!pagination.has_next ? 'disabled' : ''}>
                    Berikutnya ‚Ä∫
                </button>
            `;
            
            paginationDiv.style.display = 'flex';
        }

        // Check for URL parameters
        const urlParams = new URLSearchParams(window.location.search);
        const initialOrderBy = urlParams.get('order_by') || null;
        const initialPage = parseInt(urlParams.get('page')) || 1;

        // Load anime list on page load
        loadAnimeList(initialPage, initialOrderBy);
    </script>
</body>
</html>
